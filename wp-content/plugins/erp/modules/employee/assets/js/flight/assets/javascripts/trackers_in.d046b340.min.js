function strToDateObj(_date){var _d=_date.replace(/[- :.\s]/g,",").split(",");return new Date(_d[0],_d[1]-1,_d[2]).toString()}function convertDate(_d){return!!_d&&(_d=_d.split(/-|\//),_d[2]+"-"+_d[0]+"-"+_d[1])}function getPax(){for(var rm=iti_json.searchInfo.rooms,pax=0,i=0;i<rm.length;i++)pax=rm[i].adults+rm[i].children;return pax}function dateDiff(){var date1=new Date,date2=new Date(strToDateObj(sJson.sectorInfos[0].date)),timeDiff=Math.abs(date2.getTime()-date1.getTime());return Math.ceil(timeDiff/864e5)}function getFltLen(){for(var flt_len={on:0,rt:0},flt=ticket_json.items.flights,i=0;i<flt.length;i++)flt[i].isReturn?flt_len.rt++:flt_len.on++;return flt_len}function helperGetOMTR(_flt){var txt=";",_flag=!0;return $.each(_flt,function(i,obj){obj.isReturn&&_flag&&(txt+=",;",_flag=!1),txt+=obj.carrier.code+"-"+obj.flightNo+"#"}),txt}function getOMTR(){return helperGetOMTR(iti_json.flights)}function getTicketOMTR(){var _flt=ticket_json.items.flights,txt=";",_flag=!0;$.each(_flt,function(i,obj){if(obj.isReturn&&_flag){txt+=",;",txt+=paxCnt+";";var temp=getFltLen();txt+=paxCnt*(temp.on+temp.rt)+",",_flag=!1}txt+=obj.carrier.code+"-"+obj.flightNo+"#"}),txt+=paxCnt+";";var temp=getFltLen();return txt+=paxCnt*(temp.on+temp.rt)+","}function pushFMN(){localStorage.trackers||(localStorage.trackers="[]");var _tr=JSON.parse(localStorage.trackers);return _tr.length>=100&&_tr.shift(),_tr.push(iti_json.itinKey),localStorage.trackers=JSON.stringify($.unique(_tr)),!0}function inLocalStorage(){if(localStorage.trackers){var _tr=JSON.parse(localStorage.trackers),index=_tr.indexOf(ticket_json.refId);return index>-1&&("IN_PROGRESS"==ticket_json.status||"CONFIRMED"==ticket_json.status)}return!1}function removeFMN(){if(localStorage.trackers){var _tr=JSON.parse(localStorage.trackers),index=_tr.indexOf(ticket_json.refId);index>-1&&_tr.splice(index,1),localStorage.trackers=JSON.stringify($.unique(_tr))}}function HelperBuildETForItinerary(pax,len,flt,name){for(var obj=[],nameArr=2==len?name.split(","):[name],i=0;i<len;i++)obj.push({quantity:pax.adt+pax.chd,price:1,name:nameArr[i].replace(/;/g,""),variant:pax.adt+"|"+pax.chd+"|"+pax.inf,id:nameArr[i].replace(/;/g,""),category:"flight",brand:flt[0].carrier.code});return obj}var TRACKER_UTILS=new function(){this.isEmpty=function(inputStr){return null==inputStr||""==inputStr||"undefined"==inputStr},this.buildETForItinerary=function(){var pax=iti_json.searchQuery.paxCount,len=iti_json.searchQuery.sectorInfos.length,name=getOMTR();return HelperBuildETForItinerary(pax,len,iti_json.flights,name)},this.buildETForTicket=function(){var pax=ticket_json.srchQry.paxCount,len=ticket_json.srchQry.sectorInfos.length,name=helperGetOMTR(ticket_json.items.flights);return HelperBuildETForItinerary(pax,len,ticket_json.items.flights,name)}},GOOG_ANALYTICS=new function(){var initialised=!1;this.init=function(){ga("require","ec"),initialised=!0},this.formatData=function(data){return data},this.logSearchResult=function(data){if(initialised){var formattedData=this.formatData(data);this.addProduct(formattedData),this.setAction("click","{'list': 'Search Results'}")}},this.logTravellersPage=function(data){if(initialised)for(var index=0;index<data.products.length;index++){var formattedData=this.formatData(data.products[index]);this.addProduct(formattedData),this.setAction("detail")}},this.logAddToCart=function(data){if(initialised)for(var index=0;index<data.products.length;index++){var formattedData=this.formatData(data.products[index]);this.addProduct(formattedData),this.setAction("add"),this.sendEvent("ecomm","click","add to cart")}},this.logRemoveFromCart=function(data){if(initialised)for(var index=0;index<data.products.length;index++){var formattedData=this.formatData(data.products[index]);this.addProduct(formattedData),this.setAction("remove"),this.sendEvent("ecomm","click","remove from cart")}},this.logProceedPayment=function(data){if(initialised){for(var index=0;index<data.products.length;index++){var formattedData=this.formatData(data.products[index]);this.addProduct(formattedData)}this.setAction("checkout",{step:1,option:"payment pop up opened"}),this.sendEvent("ecomm","click","checkout")}},this.logSelectPayMode=function(payMode){initialised&&(this.setAction("checkout",{step:2,option:payMode}),this.sendEvent("ecomm","click","checkout"))},this.logPay=function(){initialised&&(this.setAction("checkout",{step:3,option:"pay"}),this.sendEvent("ecomm","click","checkout"))},this.logFinalPay=function(){initialised&&(this.setAction("checkout",{step:4,option:"final pay"}),this.sendEvent("ecomm","click","checkout"))},this.logPurchase=function(data){if(initialised&&!TRACKER_UTILS.isEmpty(data.products)){for(var index=0;index<data.products.length;index++){var formattedData=this.formatData(data.products[index]);this.addProduct(formattedData)}this.setAction("purchase",data.purchase)}},this.sendEvent=function(cat,ac,lab,val){ga("send","event",cat,ac,lab,val,{nonInteraction:1})},this.setAction=function(action,actionData){ga("ec:setAction",action,actionData)},this.addProduct=function(product){ga("ec:addProduct",product)}},A_TRACKER_LIST=[GOOG_ANALYTICS],ET=new function(){this.aData,this.formValidated;var that=this;this.init=function(){A_TRACKER_LIST.forEach(function(tkr){tkr.init()})},this.logSearchResult=function(){A_TRACKER_LIST.forEach(function(tkr){tkr.logSearchResult(that.aData)})},this.logTravellersPage=function(){A_TRACKER_LIST.forEach(function(tkr){tkr.logTravellersPage(that.aData)})},this.logAddToCart=function(){"undefined"!=typeof that.formValidated&&that.formValidated&&A_TRACKER_LIST.forEach(function(tkr){tkr.logAddToCart(that.aData)})},this.logProceedPayment=function(){A_TRACKER_LIST.forEach(function(tkr){tkr.logProceedPayment(that.aData)})},this.logRemoveFromCart=function(){A_TRACKER_LIST.forEach(function(tkr){tkr.logRemoveFromCart(that.aData)})},this.logSelectPayMode=function(payMode){A_TRACKER_LIST.forEach(function(tkr){tkr.logSelectPayMode(payMode)})},this.logPay=function(){A_TRACKER_LIST.forEach(function(tkr){tkr.logPay()})},this.logFinalPay=function(){A_TRACKER_LIST.forEach(function(tkr){tkr.logFinalPay()})},this.logPurchase=function(){A_TRACKER_LIST.forEach(function(tkr){tkr.logPurchase(that.aData)})}};