var searchBoxObj=function(){function attachAutocomplete(element,linkedTo,matchWith){element.autocomplete({source:function(request,response){var countDest="";1==$("input#one-way:checked").length&&"#destination"==element.selector&&(countDest="?include=country");var url=JS_UTIL.addAjaxSystemParams("/apiv2/flight/airports-auto/"+element.val()+countDest,{jsonData:!1,addAuthToken:!0}),successHandler=function(data){data&&(airportData=data.apts,cntryWiseApts=data.cntryWiseApts,nearByApts=data.nearByApts,phoneticApts=data.phoneticApts,countries=data.countries);responseData=[];for(var key in countries){var temp={};temp.label=countries[key].country,temp.country=countries[key].country,temp.value=countries[key].countryCode,temp.countryCd=countries[key].countryCode,temp.name=countries[key].country,temp.cntryWiseApts=!1,temp.nearByApts=!1,temp.phoneticApts=!1,responseData.push(temp)}for(var key in airportData){temp={};var airportCode=airportData[key].code;temp.label=airportData[key].name+" - "+airportData[key].country,temp.name=airportData[key].name,temp.value=airportCode,temp.city=airportData[key].city,temp.country=airportData[key].country,temp.cntryWiseApts=!1,temp.nearByApts=!1,temp.phoneticApts=!1,void 0!=linkedTo&&linkedTo.next(".airCode").val()==airportCode||responseData.push(temp)}var groupedApts=_.groupBy(cntryWiseApts,"country");_.forEach(groupedApts,function(cntryWiseApts){_.forEach(cntryWiseApts,function(apt,key){var temp={};temp.label=apt.name+","+cntryWiseApts[key].city,temp.value=apt.code,temp.name=apt.name,temp.city=apt.city,temp.country=apt.country,temp.countryCode=apt.countryCode,temp.cntryWiseApts=0===key,temp.nearByApts=!1,temp.phoneticApts=!1,responseData.push(temp)})});for(var key in nearByApts){var temp={};temp.label=nearByApts[key].name+" ["+nearByApts[key].code+"], "+nearByApts[key].distance+"KM",temp.nearBy=nearByApts[key].nearBy,temp.distance=nearByApts[key].ett,temp.value=nearByApts[key].code,temp.name=nearByApts[key].name,temp.cntryWiseApts=!1,temp.nearByApts=!0,temp.phoneticApts=!1,responseData.push(temp)}for(var key in phoneticApts){var temp={};temp.label=phoneticApts[key].name+","+phoneticApts[key].city,temp.value=phoneticApts[key].code,temp.country=phoneticApts[key].country,temp.name=phoneticApts[key].name,temp.cntryWiseApts=!1,temp.nearByApts=!1,temp.phoneticApts=0==key,responseData.push(temp)}response(responseData)},errorHandler=function(){response([])},opts={timeout:1e4,success:{handler:successHandler},error:{handler:errorHandler},scope:this,dataType:"json",type:"GET"};AJAX_UTIL.send(url,opts)},minChars:3,delay:5,select:function(event,ui){event.preventDefault(),airCode=ui.item.value.toUpperCase(),airString=ui.item.name;var eventTarget=$(event.target);eventTarget.val(airString).blur(),eventTarget.attr("data-city",ui.item.city),eventTarget.attr("data-country",ui.item.country),eventTarget.attr("data-countryCode",airCode),eventTarget.next(".airCode").val(airCode),ui.item.countryCd?eventTarget.addClass("countryActive"):eventTarget.removeClass("countryActive"),void 0!=matchWith&&matchWith.length>0&&0==matchWith.val().length&&(matchWith.val(airString),matchWith.next(".airCode").val(airCode)),"source"==$(this).attr("id")?$('input[name="destination"]').click():"destination"==$(this).attr("id")&&$("#departure").click(),$(event.target).trigger("change"),setSeniorCitizenVisibility(),TRAVTYPE=isSrchDom()?"DOM":"INTL",loadPreferredCarriers(TRAVTYPE.toLowerCase()),resetPaxNPrefCarrier()},open:function(event,ui){$(".ui-autocomplete").off("menufocus hover mouseover mouseenter")}}).autocomplete("instance")._renderItem=function(ul,item){var returnVal,countryCd=item.countryCd?"countryFlagIcon":"autoFlightIcon";return returnVal=item.cntryWiseApts?$("<li>").append('<div class="airports">Airports in '+item.country+'</div><div class="u_floatR flags-style flags-sprite '+item.countryCode+'"></div>').append('<span class="autoFlightIcon"></span>&nbsp;<span class="name">'+item.label+'</span> <span class="code">['+item.value+"]</span>"):item.nearByApts?$("<li>").append('<span class="autoFlightIcon"></span>&nbsp;<span class="nearByApts"> Nearby </span><span class="name">'+item.label+'</span> <span class="airDist">'+item.distance+"</span>"):item.phoneticApts?$("<li>").append('<div class="mean airports">Did You Mean?</div>').append('<span class="autoFlightIcon"></span>&nbsp;<span class="name">'+item.label+'</span> <span class="code">['+item.value+"]</span>"):$("<li>").append('<span class="'+countryCd+'"></span>&nbsp;<span class="name">'+item.label+'</span> <span class="code">['+item.value.toUpperCase()+"]</span>"),returnVal.appendTo(ul),returnVal},element.on("click",function(){$(this).select(),$(this).keyup(function(event){var key=event.which||event.keyCode;JS_UTIL.isTypeable(key)&&$(this).next(".airCode").val("")}),void 0!=matchWith&&matchWith.length>0&&(matchWith.val(""),matchWith.next(".airCode").val(""))})}function attachPrefCarrierAutoComplete(element,linkedTo,matchWith){element.autocomplete({source:function(request,response){var url=JS_UTIL.addAjaxSystemParams("/apiv2/flight/carrier-auto/"+element.val(),{jsonData:!1,addAuthToken:!0}),successHandler=function(data){data&&(data=data.prefC);responseData=[];for(var key in data){temp={};var carrierCode=data[key].code;temp.label=data[key].name,temp.name=data[key].name,temp.value=carrierCode,void 0!=linkedTo&&linkedTo.next(".prefCode").val()==airportCode||responseData.push(temp)}response(responseData)},errorHandler=function(){response([])},opts={timeout:1e4,success:{handler:successHandler},error:{handler:errorHandler},scope:this,dataType:"json",type:"GET"};AJAX_UTIL.send(url,opts)},minChars:2,select:function(event,ui){event.preventDefault(),prefCode=ui.item.value,prefString=ui.item.name,$(event.target).val(prefString).blur(),$(event.target).next(".prefCode").val(prefCode),void 0!=matchWith&&matchWith.length>0&&0==matchWith.val().length&&(matchWith.val(prefCode),matchWith.next(".prefCode").val(airCode))},open:function(event,ui){$(".ui-autocomplete").off("menufocus hover mouseover mouseenter")}}).autocomplete("instance")._renderItem=function(ul,item){return $("<li>").append('<span class="name">'+item.label+'</span> <span class="code">['+item.value+"]</span>").appendTo(ul)},element.on("click",function(){$(this).select(),$(this).keyup(function(event){var key=event.keyCode;JS_UTIL.isTypeable(key)&&$(this).next(".prefCode").val("")}),void 0!=matchWith&&matchWith.length>0&&(matchWith.val(""),matchWith.next(".prefCode").val(""))})}function setDepartureDate(dateObj){depDate=new Date(dateObj.defaultString),$("#departure").val(DATE_FORMATTER.format(depDate,"ddd, mmm dd yyyy").date);var returnDate=$("#return").val();returnDate&&(returnDate=new Date(returnDate),depDate.getTime()>returnDate.getTime()&&($("#return").val(DATE_FORMATTER.format(depDate,"ddd, mmm dd yyyy").date),$("#return").attr("value",DATE_FORMATTER.format(depDate,"ddd, mmm dd yyyy").date),$("#return").attr("data-date",DATE_FORMATTER.format(depDate,"mm/dd/yyyy").date))),$("#round-trip").is(":checked")&&$("#return").click()}function initSBoxValidator(){try{sBoxValidator.init()}catch(e){}}function getMinPrices(params){var src="",dest="",isReturn=!1,cal=null,departCal=null;try{src=params.src,dest=params.dest,cal=params.cal,departCal=params.departCal,isReturn=params.isReturn}catch(e){return void console.log(e)}var returnParam="",todayDate=new Date,startDate=DATE_FORMATTER.format(todayDate,"yyyy-mm-dd").date;todayDate.setFullYear(todayDate.getFullYear()+1);var endDate=DATE_FORMATTER.format(todayDate,"yyyy-mm-dd").date,onwardPrice=0;if(isReturn){var onwardDate=$("#depart_date").attr("data-date");void 0!=onwardDate&&(onwardPrice=parseFloat(departCal.getPriceOnDate(new Date(onwardDate))),startDate=onwardDate),returnParam="&isReturn"}var url=JS_UTIL.addAjaxSystemParams("/apiv2/flight/fare-calendar?",{jsonData:!1,addAuthToken:!0}),urlParams={src:src,dest:dest,startDate:startDate,endDate:endDate,fareType:"b2c",oneWay:isReturn},successHandler=function(result){if(result&&!$.isEmptyObject(result)){var calData=result.cd,currency=window.currency;for(var date in result.cd)if(calData[date].dt.length<=5){var type=date.substr(0,3),typeDates=result[date];for(var iterator in typeDates){var typeDate=typeDates[iterator],dateObj=new Date(typeDate);cal.addClassToDate(dateObj.getFullYear(),dateObj.getMonth(),dateObj.getDate(),"vc-"+type+"-cell")}}else{var price=calData[date].pr+onwardPrice,priceType=calData[date].prType,formattedPrice=PRICE_FORMATTER.format(price,null,currency,!0),dateObj=new Date(calData[date].dt);cal.addPrice(dateObj.getFullYear(),dateObj.getMonth(),dateObj.getDate(),"<i class='u_clInherit u_font7 "+currency+"'></i> "+formattedPrice,price,priceType)}var message="";envVars.isB2CEnv||(message=" (Prices shown are exclusive of agent markup)"),isReturn&&onwardPrice>0&&(message+="Minimum return fares shown for depart date "+DATE_FORMATTER.format(new Date(onwardDate),"dd mmm 'yy").date,cal.addMessage(message))}},opts={params:JSON.stringify(urlParams),type:"POST",dataType:"json",headers:{"cache-control":"max-age=120000"},async:!0,timeout:"5000",success:{handler:successHandler},scope:this};AJAX_UTIL.send(url,opts)}function airportFares(){var html='<div class="loadingDiv"><div class="loadText">'+JS_UTIL.translate("GEN_SEARCHING_LABEL","Searching")+'</div><div class="spinner"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div></div>';$("#search-flight-btn").html(html);var destination=$("#destination ~ .airCode").val(),depart_date=$("#departure").attr("data-date"),depart_date_array=JS_UTIL.getDateArrayfromObject(depart_date),sourceL=$("#source").val(),source=$("#source ~ .airCode").val(),destinationL=$("#destination").val();depart_date=depart_date_array[0]+"-"+(depart_date_array[1]+1)+"-"+depart_date_array[2];var formatedDate=JS_UTIL.displayDateMonth(new Date(strToDateObj(depart_date))),urlParams={sectorInfos:[{src:{code:source},dest:{code:destination},date:depart_date}],"class":"ALL",paxCount:{adt:"1",chd:"0",inf:"0"},prefAirlines:[],route:"ALL",disc:!1,multiHop:!1,multiCity:!1},url=JS_UTIL.addAjaxSystemParams("/apiv2/flight/destination-search?",{jsonData:!1,addAuthToken:!0}),successHandler=function(result){$("#search-flight-btn").html(languageBundle.Search_Flights),MODAL_PANEL.show(countryAirportTemplate({data:result.sectorFares,dest:destinationL,destcode:destination,source:sourceL,sourcecode:source,date:formatedDate,adult:1,Currency:window.currency}),{closeBody:!1,closeButton:!0}),$(".modalPanelContainer").css({width:"55%",border:"1px solid #d4dee5"}),$(".modalPanelContainer").on("mouseover",".fareButton",function(event){var $this=$(this);$this.qtip({content:languageBundle.Lowest_Estimated_Fare,position:{my:"bottom center",at:"top center"},style:"holidayQtip",show:{ready:!0},hide:{event:"mouseout click scroll resize"},onHide:function(){$this.qtip("destroy")}}),setTimeout(function(){$("div[id^='qtip-']").css({"z-index":9e8})},300)}),$(".selectedSector").click(function(){var destinationCode=$(this).data("aircode"),destinationName=$(this).data("name"),destination_city=$(this).data("airportcity"),dest=$("#destination");$("#destination ~ .airCode").val(destinationCode),dest.val(destinationName),dest.data("city",destination_city),MODAL_PANEL.hide(),flightSearchRequest()})},errorHandler=function(err){$("#search-flight-btn").html(languageBundle.Search_Flights),console.log("error in ajax call")},opts={params:JSON.stringify(urlParams),type:"POST",dataType:"json",timeout:"8000",success:{handler:successHandler},error:{handler:errorHandler},scope:this,async:!0};AJAX_UTIL.send(url,opts)}function flightSearchRequest(){if(1!=$("input#multi-city:checked").length){if(queryString="",1==$("input#round-trip:checked").length){queryString+="?returnType=return";var return_date=$("#return").attr("data-date"),return_date_array=JS_UTIL.getDateArrayfromObject(return_date);return_date=return_date_array[1]+1+"/"+return_date_array[2]+"/"+return_date_array[0],queryString+="&month2="+(return_date_array[1]+1)+"&day2="+return_date_array[2]+"&year2="+return_date_array[0]+"&date2="+return_date}else queryString+="?returnType=one-way";var source=$("#source ~ .airCode").val(),source_city=$("#source").data("city")||"",sourceL=$("#source").val(),destination=$("#destination ~ .airCode").val(),destination_city=$("#destination").data("city")||"",destinationL=$("#destination").val(),sourceCName=$("#source").data("country")||"",destinationCName=$("#destination").data("country")||"";queryString+="&destination="+destination+"&bdestination="+destination,queryString+="&destinationL="+destinationL+"&destinationCity="+destination_city+"&destinationCN="+destinationCName,queryString+="&source="+source+"&bsource="+source,queryString+="&sourceL="+sourceL+"&sourceCity="+source_city+"&sourceCN="+sourceCName;var depart_date=$("#departure").attr("data-date"),depart_date_array=JS_UTIL.getDateArrayfromObject(depart_date);depart_date=depart_date_array[1]+1+"/"+depart_date_array[2]+"/"+depart_date_array[0],queryString+="&month="+(depart_date_array[1]+1)+"&day="+depart_date_array[2]+"&year="+depart_date_array[0]+"&date="+depart_date}else{queryString="",queryString+="?returnType=multi";for(var i=1;i<=numMultiFlights;i++){var sourceEl=$("#source-"+(i-1));source=sourceEl.siblings(".airCode").val();var sourceL=sourceEl.val(),destinationEl=$("#destination-"+(i-1));destination=destinationEl.siblings(".airCode").val();var destinationL=destinationEl.val();queryString+="&source_"+i+"="+source+"&bsource_"+i+"="+source,queryString+="&sourceL_"+i+"="+sourceL,queryString+="&destination_"+i+"="+destination+"&bdestination_"+i+"="+destination,queryString+="&destinationL_"+i+"="+destinationL,depart_date=Date.parse($("#departure-"+(i-1)).val());var depart_date_array=JS_UTIL.getDateArrayfromObject(depart_date);depart_date=depart_date_array[1]+1+"/"+depart_date_array[2]+"/"+depart_date_array[0],queryString+="&month_"+i+"="+(depart_date_array[1]+1)+"&day_"+i+"="+depart_date_array[2]+"&year_"+i+"="+depart_date_array[0]+"&date_"+i+"="+depart_date}queryString+="&numFlights="+numMultiFlights}$(this).unbind("click");var formEl=$(".flightSearchForm");queryString+="&numAdults="+formEl.find(".counter-element.adult .count").text(),queryString+="&numChildren="+formEl.find(".counter-element.child .count").text(),queryString+="&numInfants="+formEl.find(".counter-element.infant .count").text(),queryString+="&validation_result=&domesinter=international&livequote=-1&flightClass="+formEl.find(".preferredClass").val(),queryString+="&travType="+TRAVTYPE,queryString+="&routingType="+$("#routingType").val(),$("#senior_citizen").is(":checked")&&(queryString+="&senior_citizen=on");var pageType=$("#pageType").val(),airlineCode=parseInt($("#airlineCode").val());"airline"==pageType&&airlineCode>0?queryString+="&preferredCarrier="+airlineCode+"&prefCarrier="+airlineCode:queryString+="&preferredCarrier="+$(".prefCode").val()+"&prefCarrier=0";var isAjaxCheck="&isAjax="+isHomePage.isHomePage;if(window.location.origin||(window.location.origin=window.location.protocol+"//"+window.location.hostname),isHomePage.isHomePage){var html='<div class="loadingDiv"><div class="loadText">'+JS_UTIL.translate("GEN_SEARCHING_LABEL","Searching")+'</div><div class="spinner"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div></div>';$("#search-flight-btn").html(html);var url="/flight/search"+encodeURI(queryString+isAjaxCheck),successHandler=function(data){isHomePage.isHomePage=!1,$(".adJCarousel").jcarousel("destroy"),window.history.pushState({page:"search"},"Search Result","/flight/search"+encodeURI(queryString+"&isAjax=false")),$(".searchBoxCalendarDiv,#calHolidayList,.threePointHighlight,.top_deals,.subscribe,.top_destinations,.mobiApp,.why_book,.testimonials,.waitBox").remove(),$(".flightSearchForm").remove(),$("#footerCont").before(data),$(".searchBoxHome").slideUp(500,function(){$(this).remove(),searchBoxObj()})},errorHandler=function(request,status,err){"timeout"==status?console.log("Timeout"):console.log("error in ajax call")},opts={type:"GET",async:!0,timeout:"30000",success:{handler:successHandler},error:{handler:errorHandler},scope:this};AJAX_UTIL.send(url,opts)}else showWaitDiv(),console.log(window.location.href=window.location.origin+"/flight/search"+encodeURI(queryString+isAjaxCheck))}var calHolidayList=JSON.parse($("#calHolidayList").html()),envVars=JSON.parse($("#environmentVars").html()),isHomePage=JSON.parse($(".isHomePageAv").html()),CARRIERJSON=JSON.parse($("#js-prefCarrierJson").html()),MAXPAX=9,TRAVTYPE="INTL",searchBoxOpts=JSON.parse($("#js-searchBoxOpts").html()),BASECLASSLIST=searchBoxOpts.baseClassList;$(".mainAdListItem").find(".banner-image").css("width",$(document).width());var countryAirportTemplate=_.template($("#countryAirportTemplate").html(),{});for(attachAutocomplete($("#source")),attachAutocomplete($("#destination"),$("#source")),i=0;i<5;i++)attachAutocomplete($("#source-"+i),$("#destination-"+i)),attachAutocomplete($("#destination-"+i),$("#source-"+i),$("#source-"+(i+1)));attachPrefCarrierAutoComplete($("#prefCarrier")),$(".flightSearchForm .counter-element .plus").click(function(event){var counterEl=$(this).parents(".counter-element"),adultCount=parseInt(counterEl.parent("div").find(".adult .count").html()),childCount=parseInt(counterEl.parent("div").find(".child .count").html()),infantCount=parseInt(counterEl.parent("div").find(".infant .count").html()),countEl=counterEl.find(".count"),count=parseInt(countEl.html()),incrementOf=counterEl.attr("data-for");eval(incrementOf+"Count++"),valid=!1;var totalCount=adultCount+childCount;totalCount<=MAXPAX&&adultCount>=infantCount&&infantCount<=MAXPAX&&(valid=!0),count=valid?count+1:count,countEl.html(count),event.preventDefault()}),$(".flightSearchForm .counter-element .minus").click(function(event){var countEl=$(this).parents(".counter-element").find(".count"),adultFlag=$(this).parents(".counter-element").hasClass("adult"),counterEl=$(this).parents(".counter-element"),count=parseInt(countEl.html());if(adultFlag){if(1==count)return;var infantCount=parseInt(counterEl.parent("div").find(".infant .count").html());infantCount==count&&(infantCount--,counterEl.parent("div").find(".infant .count").html(infantCount))}count=count>0?count-1:count,countEl.html(count),event.preventDefault()});var date=new Date;date.setFullYear(date.getFullYear()+1);var endDate=DATE_FORMATTER.format(date,"mm/dd/yyyy").date,depart_cal=new VIA_CALENDER($("#departure"),setDepartureDate,{defaults:{holidayList:calHolidayList,numMonths:2,endDate:endDate,title:JS_UTIL.translate("GEN_SEL_DEP_DATE","Select Departure Date"),calId:"depart-cal",format:"ddd, mmm dd yyyy",alterCallback:getMinPrices,showCal:showCalSeo,hideCal:hideCalSeo}}),return_cal=new VIA_CALENDER($("#return"),null,{defaults:{holidayList:calHolidayList,linkedTo:"departure",numMonths:2,endDate:endDate,title:JS_UTIL.translate("GEN_SEL_RET_DATE","Select Return Date"),calId:"return-cal",format:"ddd, mmm dd yyyy",alterCallback:getMinPrices,showCal:showCalSeo,hideCal:hideCalSeo}});if($("#departure, #departure~.calIconHolder .calendar-icon").click(function(){return_cal.hide(),initSBoxValidator();var selectedDate=$("#departure").attr("data-date");depart_cal.show({defaults:{selectedDate:selectedDate,viewDate:selectedDate,alterCallbackOpts:{src:$("#source ~ .airCode").val(),departCal:depart_cal,isReturn:!1,dest:$("#destination ~ .airCode").val()}}})}),$(".searchboxSeo").length){$("#departure").click();var showCal=$("#headerCont").height();$(window).scroll(function(){var height=$(window).scrollTop();return_cal.hide(),height<showCal?(depart_cal.show(),$(".routeContainer").removeAttr("style").css({"margin-top":"0px"})):(depart_cal.hide(),$(".routeContainer").removeAttr("style").css({"margin-top":"150px"}))})}$("#return, #return~.calIconHolder .calendar-icon").click(function(){depart_cal.hide(),initSBoxValidator(),return_cal.show({defaults:{alterCallbackOpts:{src:$("#destination ~ .airCode").val(),departCal:depart_cal,isReturn:!0,dest:$("#source ~ .airCode").val()}}})}),$(".return-element").click(function(){$("#one-way").prop("checked")&&($("#round-trip").click(),initSBoxValidator(),return_cal.show({defaults:{alterCallbackOpts:{src:$("#destination ~ .airCode").val(),departCal:depart_cal,isReturn:!0,dest:$("#source ~ .airCode").val()}}}))}),$("input[name^='departure']").focus(function(){depart_cal.show({defaults:{alterCallbackOpts:{src:$("#destination ~ .airCode").val(),departCal:depart_cal,isReturn:!0,dest:$("#source ~ .airCode").val()}}})}),$("#return").focus(function(){return_cal.show({defaults:{alterCallbackOpts:{src:$("#destination ~ .airCode").val(),departCal:depart_cal,isReturn:!0,dest:$("#source ~ .airCode").val()}}})}),$("#one-way").click(function(){return_cal.hide(),$("#one-way").prop("checked")&&$(".return-element input").val("")}),$("#round-trip").click(function(){$("#destination").hasClass("countryActive")&&($("#destination").val(""),$("#destination ~ .airCode").val(""))}),isHomePage.isHomePage&&$(".return-element input").val(""),$(".panel-head label").click(initSBoxValidator),$("#source").click().select();for(var depart_cal_array=[],i=0;i<5;i++){var defaults=new Object;defaults={defaults:{holidayList:calHolidayList,numMonths:2,endDate:endDate,title:"Select Departure Date",calId:"depart-cal-"+i,format:"ddd, mmm dd yyyy",alterCallback:getMinPrices}},i>0&&(defaults.defaults.linkedTo="departure-"+(i-1)),depart_cal_array[i]=new VIA_CALENDER($("#departure-"+i),null,defaults),$("#departure-"+i+", #departure-"+i+"~.calIconHolder .calendar-icon").click(function(){var inputElement=$(this).parents(".element").find('input[type="text"]'),inputElementIndex=parseInt($(inputElement).attr("index"));depart_cal_array[inputElementIndex].show({defaults:{alterCallbackOpts:{src:$("#source-"+inputElementIndex+" ~ .airCode").val(),departCal:depart_cal_array[inputElementIndex],isReturn:!1,dest:$("#destination-"+inputElementIndex+" ~ .airCode").val()}}})})}$("#search-flight-btn").on("click",_.debounce(function(){if(1!=$("input#multi-city:checked").length){var placeValidator=function(el){return 0!=$(el+" ~ .airCode").val().length};if(sBoxValidator=new VIA_VALIDATOR,sBoxValidator.addElement(".flightSearchForm #source",placeValidator,JS_UTIL.translate("GEN_SEL_DEP_AIRPORT","Select Departing Airport")),sBoxValidator.addElement(".flightSearchForm #destination",placeValidator,JS_UTIL.translate("GEN_SEL_ARR_AIRPORT","Select Arriving Airport")),sBoxValidator.addElement(".flightSearchForm input#destination",function(){return $(".flightSearchForm #destination").val()!=$(".flightSearchForm #source").val()||$("#destination").data("countrycode")!=$("#source").data("countrycode")},JS_UTIL.translate("GEN_SRC_DEST_SAME","Source and Destination are Same")),sBoxValidator.addElement(".flightSearchForm #departure","required",JS_UTIL.translate("GEN_SEL_DEPT_DATE_FROM_CAL","Select Departure Date From Calendar")),!sBoxValidator.validate())return;if(1==$("input#round-trip:checked").length&&(sBoxValidator.addElement(".flightSearchForm #return","required",JS_UTIL.translate("GEN_SEL_RET_DATE_FROM_CAL","Select Return Date From Calendar")),!sBoxValidator.validate()))return}else{sBoxValidator=new VIA_VALIDATOR;var placeValidator=function(el){var index=parseInt(el[el.length-1]),valid=0!=$(el+" ~ .airCode").val().length;return valid||($("#multi-city-"+index).prop("checked",!0),$(el).focus()),valid},dateArray=[],dateValidator=function(el){var index=parseInt($(el).attr("index")),valid=0!=$(el).val().length;valid?dateArray.push(new Date($(el).val())):$("#multi-city-"+index).prop("checked",!0);for(var index=1;index<dateArray.length;index++)if(dateArray[index]<dateArray[index-1])return void alert("Please check your departure dates");return valid};numMultiFlights=$(".flightSearchForm [id^='multi-city-label-']").filter(":visible").length;for(var i=0;i<numMultiFlights;i++)sBoxValidator.addElement(".flightSearchForm #source-"+i,placeValidator,JS_UTIL.translate("GEN_SEL_DEP_AIRPORT","Select Departing Airport")),sBoxValidator.addElement(".flightSearchForm #destination-"+i,placeValidator,JS_UTIL.translate("GEN_SEL_ARR_AIRPORT","Select Arriving Airport")),sBoxValidator.addElement(".flightSearchForm #departure-"+i,dateValidator,JS_UTIL.translate("GEN_SEL_DEPT_DATE_FROM_CAL","Select Departure Date From Calendar"));if(!sBoxValidator.validate())return}$("#destination").hasClass("countryActive")?airportFares():flightSearchRequest()},500,{leading:!0,trailing:!1})),window.showWaitDiv=function(){var formEl=$(".flightSearchForm"),waitBox=$(".waitBox");1!=formEl.find("input#multi-city:checked").length?(waitBox.find(".onwInfo .airCode").html(formEl.find("#source ~ .airCode").val()),waitBox.find(".onwInfo .city").html(formEl.find("#source").data("city")),waitBox.find(".onwInfo .name").html(formEl.find("#source").val()),waitBox.find(".retInfo .airCode").html(formEl.find("#destination ~ .airCode").val()),waitBox.find(".retInfo .city").html(formEl.find("#destination").data("city")),waitBox.find(".retInfo .name").html(formEl.find("#destination").val()),waitBox.find(".dates .onward .dateString").html(formEl.find("#departure").val()),1==formEl.find("input#round-trip:checked").length?(waitBox.find(".fltLogo > div").attr("class","").addClass("retLogo"),waitBox.find(".dates .return .dateString").html(formEl.find("#return").val()),waitBox.find(".dates .return").css("display","inline-block")):waitBox.find(".fltLogo > div").attr("class","").addClass("onwLogo")):(waitBox.find(".onwInfo .airCode").html(formEl.find("#source-0 ~ .airCode").val()),waitBox.find(".onwInfo .city").html(formEl.find("#source-0").data("city")),waitBox.find(".onwInfo .name").html(formEl.find("#source-0").val()),waitBox.find(".retInfo .airCode").html(formEl.find("#destination-"+(numMultiFlights-1)+" ~ .airCode").val()),waitBox.find(".retInfo .city").html(formEl.find("#destination-"+(numMultiFlights-1)).data("city")),waitBox.find(".retInfo .name").html(formEl.find("#destination-"+(numMultiFlights-1)).val()),waitBox.find(".dates .onward .dateString").html(formEl.find("#departure-0").val()),waitBox.find(".fltLogo > div").attr("class","").addClass("multiLogo")),waitBox.find(".passenger-info .adult .count").html(formEl.find(".counter-element.adult .count").text()),waitBox.find(".passenger-info .child .count").html(formEl.find(".counter-element.child .count").text()),waitBox.find(".passenger-info .infant .count").html(formEl.find(".counter-element.infant .count").text()),MODAL_PANEL.show(waitBox)},$('[name="mode"]').change(function(){initSBoxValidator(),setSeniorCitizenVisibility()});var numMultiFlights=2;$(".add-flight-btn").click(function(){numMultiFlights=$(".flightSearchForm [id^='multi-city-label']").filter(":visible").length,$(".flightSearchForm #multi-city-label-"+numMultiFlights).show(),document.flightSearchForm.current_flight.value=numMultiFlights++,5==numMultiFlights&&$(this).hide(),$(".flightSearchForm .panel-head .close").hide(),$(".flightSearchForm .panel-head label:nth-child("+numMultiFlights+")").find(".close").css("display","inline-block")}),$(".flightSearchForm #multi-city-panel .close").click(function(){$(this).parent("label").hide(),setTimeout(function(){document.flightSearchForm.current_flight.value=--numMultiFlights-1},100),$(".add-flight-btn").show(),$(".flightSearchForm .panel-head .close").hide(),numMultiFlights>2&&$(".flightSearchForm .panel-head label").not(":hidden").last().find(".close").css("display","inline-block")});var setSeniorCitizenVisibility=function(){var visible=isSrchDom();visible?($("#senior_citizen").parents(".cBox").show(),$(".senCitiLbl").show()):($("#senior_citizen").parents(".cBox").hide(),$("#senior_citizen").prop("checked",!1),$(".senCitiLbl").hide(),seniorCitizenChkBoxClkFunc())},isSrchDom=function(){var isMulticity=!1,sourceDomestic=!1,destinationDomestic=!1,currentCountry=envVars.countryName,isDomSrch=$("#source").attr("data-isdomestic"),sourceCountry=$("#source").attr("data-country"),destinationCountry=$("#destination").attr("data-country");"true"==isDomSrch&&(sourceCountry=currentCountry,destinationCountry=currentCountry);var retBool=!1;return $("input#multi-city:checked").length>0&&(isMulticity=!0),sourceCountry==currentCountry&&(sourceDomestic=!0),destinationCountry==currentCountry&&(destinationDomestic=!0),!isMulticity&&sourceDomestic&&destinationDomestic&&(retBool=!0),retBool},recentSearch={};recentSearch.getRecentSearch=function(){var successHandler=function(data){data.userRecentActivities&&!jQuery.isEmptyObject(data.userRecentActivities)&&recentSearch.setRecentSearch(data.userRecentActivities)},opts={success:{handler:successHandler},scope:this},url="apiv2/communicate/scratch-pad/flight/search-result/5";url=JS_UTIL.addAjaxSystemParams(url,{jsonData:!1,addAuthToken:!0}),AJAX_UTIL.send(url,opts)},recentSearch.setSearchFields=function(el,autoSearchOff){if(!(el.length<=0)){var form=$(".flightSearchForm"),returnType=el.data("returntype"),numAdults=el.find(".numAdults").text(),numChildren=el.find(".numChildren").text()||0,numInfants=el.find(".numInfants").text()||0,isDomestic=el.attr("data-isdomestic");if($(".showRecentSearch").toggleClass("closed"),"multi"!=returnType){var source=el.find(".source").text(),sourceL=el.find(".sourceL").text(),destination=el.find(".destination").text(),destinationL=el.find(".destinationL").text(),departureDefaultStr=(el.find(".departure").text(),el.find(".departure").attr("data-date")),returnDefaultStr=(el.find(".return").text(),el.find(".return").attr("data-date"));"return"==returnType?(form.find("#round-trip").prop("checked",!0),form.find("#return").val(DATE_FORMATTER.format(returnDefaultStr,"ddd, mmm dd yyyy").date),form.find("#return").attr({"data-date":returnDefaultStr})):form.find("#one-way").prop("checked",!0),form.find("#source").val(sourceL),form.find("#source ~ .airCode").val(source),form.find("#destination").val(destinationL),form.find("#destination ~ .airCode").val(destination),form.find("#departure").val(DATE_FORMATTER.format(departureDefaultStr,"ddd, mmm dd yyyy").date),form.find("#departure").attr({"data-date":departureDefaultStr}),"true"==isDomestic?(form.find("#source").attr("data-country",envVars.countryName),form.find("#destination").attr("data-country",envVars.countryName),TRAVTYPE="DOM",loadPreferredCarriers("dom")):(form.find("#source").attr("data-country",""),form.find("#destination").attr("data-country",""),TRAVTYPE="INTL",loadPreferredCarriers("intl")),autoSearchOff&&"true"!=isDomestic&&(fillCountry("#source"),fillCountry("#destination"));var sel=el.attr("data-prefCar")?el.attr("data-prefCar").toString():"ALL";$("#prefCarrier option[value='"+sel+"']").prop("selected",!0)}else{form.find("#multi-city").prop("checked",!0);var index,srcAirportList=el.data("srcAirportList"),srcList=el.data("srcList"),destList=el.data("destList"),destAirportList=el.data("destAirportList"),departureDateList=el.data("departureDateList");for(index=0;index<srcList.length;index++){index>numMultiFlights-1&&form.find(".add-flight-btn").click(),form.find("#source-"+index).val(srcAirportList[index]),form.find("#destination-"+index).val(destAirportList[index]),form.find("#source-"+index+" ~ .airCode").val(srcList[index]),form.find("#destination-"+index+" ~ .airCode").val(destList[index]);var depDate=new Date(departureDateList[index]);form.find("#departure-"+index).val(DATE_FORMATTER.format(depDate,"ddd, mmm dd yyyy").date)}}form.find(".counter-element.adult .count").text(numAdults),form.find(".counter-element.child .count").text(numChildren),form.find(".counter-element.infant .count").text(numInfants),autoSearchOff||$("#search-flight-btn").trigger("click"),$(".showRecentSearch").toggleClass("closed"),"true"==el.attr("data-isdomestic")?$("#senior_citizen").parents(".cBox").show():$("#senior_citizen").parents(".cBox").hide()}},recentSearch.setRecentSearch=function(recentSearches){var sampleResult=$(".recentSearch .result.sample"),sampleMulticityResult=$(".recentSearch .result.multicitySample"),clonedResult=sampleResult.clone(),clonedMulticityResult=sampleMulticityResult.clone(),placeContainer=clonedMulticityResult.find(".placeContainer.sample").clone();
sampleResult.remove(),sampleMulticityResult.remove(),clonedMulticityResult.find(".placeContainer.sample").remove(),clonedResult.removeClass("sample"),clonedMulticityResult.removeClass("multicitySample"),placeContainer.removeClass("sample");var resultContainer=$(".recentSearch .recentSearchBody");for(index in recentSearches){var result=recentSearches[index];if("multi"!=result.returnType){var tempResult=clonedResult.clone(),owdSector=result.sectors[0];$(tempResult).find(".sourceL").text(owdSector.src.name),$(tempResult).find(".destinationL").text(owdSector.dest.name),$(tempResult).find(".source").text(owdSector.src.code),$(tempResult).find(".destination").text(owdSector.dest.code);var departDate=new Date(owdSector.date);if($(tempResult).find(".departure").text(DATE_FORMATTER.format(departDate,"ddd, mmm dd yyyy").date),$(tempResult).find(".departure").attr({"data-date":departDate}),result.sectors[1]){var returnDate=new Date(result.sectors[1].date);$(tempResult).data("returntype","return"),$(tempResult).find(".onwLogo").removeClass("onwLogo").addClass("retLogo"),$(tempResult).find(".dateContainer").append(' | <div class="return" data-date="'+returnDate+'" >'+DATE_FORMATTER.format(returnDate,"ddd, mmm dd yyyy").date+"</div>")}tempResult.find(".numAdults").text(result.paxCount.adt),tempResult.find(".numChildren").text(result.paxCount.chd),tempResult.find(".numInfants").text(result.paxCount.inf)}else{var tempResult=clonedMulticityResult.clone();tempResult.data("returntype","multi");var keysList=["departureDateList","srcAirportList","srcCityList","srcList","destCityList","destList","destAirportList"];for(key in keysList)tempResult.data(keysList[key],result[keysList[key]]);var index,classNameArrayNameMap={source:"srcList",destination:"destList",departure:"departureDateList"};for(index=0;index<result.departureDateList.length;index++)result.departureDateList[index]=DATE_FORMATTER.format(new Date(result.departureDateList[index]),"ddd, mmm dd yyyy").date;for(index=0;index<result.srcList.length;index++){var clonedPlaceContainer=placeContainer.clone();for(className in classNameArrayNameMap)clonedPlaceContainer.find("."+className).text(result[classNameArrayNameMap[className]][index]);clonedPlaceContainer.insertBefore(tempResult.find(".numPax"))}var keysList=["numAdults","numChildren","numInfants"];for(key in keysList)tempResult.find("."+keysList[key]).text(result[keysList[key]])}resultContainer.append(tempResult)}$(".recentSearch").show(),$(".recentSearch .result").click(function(){recentSearch.setSearchFields($(this))}),recentSearch.setSearchFields($(".recentSearch .result").first(),!0)},$(".searchbox.recentSearch").length&&recentSearch.getRecentSearch();try{$(".adJCarousel").jcarousel({wrap:"circular",transitions:!0}).jcarouselAutoscroll({interval:5e3,target:"+=1",autostart:!0});var prevActive=1;$(".adJCarouselPagination").jcarouselPagination({perPage:1,item:function(page){return'<div class="circlePaginate" data-index='+page+"></div>"}}).on("jcarouselpagination:active","div",function(){$("#mainAdListItem-"+prevActive).hide(),$("#mainAdListItem-"+$(this).data("index")).show(),$(this).addClass("active")}).on("jcarouselpagination:inactive","div",function(){prevActive=$(this).data("index"),$(this).removeClass("active")})}catch(e){}var seniorCitizenChkBoxClkFunc=function(){$("#senior_citizen").is(":checked")?($(".flightSearchForm .counter-element.child .count").html("0"),$(".flightSearchForm .counter-element.infant .count").html("0"),$(".flightSearchForm .counter-element.child > div").css({"pointer-events":"none","background-color":"#EBF2F7"}),$(".flightSearchForm .counter-element.infant > div").css({"pointer-events":"none","background-color":"#EBF2F7"}),$(".senCitiMsgLbl").show()):($(".flightSearchForm .counter-element.child > div").css({"pointer-events":"all","background-color":"#fff"}),$(".flightSearchForm .counter-element.infant > div").css({"pointer-events":"all","background-color":"#fff"}),$(".senCitiMsgLbl").hide())};$("#senior_citizen").click(function(){seniorCitizenChkBoxClkFunc()});var isSeniorCitizen=$(".flightSearchForm").find("#senior_citizen").attr("previouslySet");isSeniorCitizen&&$("#senior_citizen").click(),$(".senCitiMsgLbl").click(function(){var msg=JS_UTIL.translate("Senior_Citizen_Important_Message",""),seniorCitizenMsgDiv=$('<div id="seniorCitizenMsgDiv"><div class="headTxt">'+JS_UTIL.translate("Senior_Citizen_Imp_Msg_Header","Senior Citizen Important Message")+'</div><div class="msgTxt">'+msg+"</div></div>");MODAL_PANEL.show(seniorCitizenMsgDiv,{closeButton:!0})}),$("#prefCarrier").change(function(){var prefCarrier=$("#prefCarrier").val();"All"!=prefCarrier&&(prefCarrier=parseInt($("#prefCarrier").val()))});var getBookingClasses=function(prefCarrier){var classListHtml=getBaseClassList(),maxNumPax=9,carrJSON=CARRIERJSON.internationalCarriers,BKCPrepender="";if(isSrchDom()&&(carrJSON=CARRIERJSON.domesticCarriers,BKCPrepender="S_"),"All"!=prefCarrier){maxNumPax=carrJSON[prefCarrier].maxNumPassengers;var BkClasses=carrJSON[prefCarrier].classesForCarrier;0==maxNumPax&&(maxNumPax=9),BkClasses.length>0&&$.each(BkClasses,function(index,val){classListHtml+='<option value="'+BKCPrepender+val+'">'+val+"</option>"})}MAXPAX=maxNumPax,$("#preferredClass").html(classListHtml)},getBaseClassList=function(){var baseClassListHtml="";return $.each(BASECLASSLIST,function(index,val){baseClassListHtml+='<option value="'+val.value+'">'+val.name+"</option>"}),baseClassListHtml},loadPreferredCarriers=function(srchType){},resetPaxNPrefCarrier=function(){$("#prefCarrier").val("All").trigger("change"),resetPaxNums()},resetPaxNums=function(){var adtPax=parseInt($(".counter-element.adult .count").html()),chdPax=parseInt($(".counter-element.child .count").html()),totPax=(parseInt($(".counter-element.infant .count").html()),adtPax+chdPax);totPax>MAXPAX&&($(".counter-element.adult .count").html("1"),$(".counter-element.child .count").html("0"),$(".counter-element.infant .count").html("0"))},fillCountry=function(selector){var airCode=$(selector+" ~ .airCode").val(),url=JS_UTIL.addAjaxSystemParams("/apiv2/flight/airports-auto/"+airCode,{jsonData:!1,addAuthToken:!0}),successHandler=function(data){data&&(data=data.outputJson);var country="";for(var key in data)airCode==data[key].code&&(country=data[key].country);$(selector).attr("data-country",country)},opts={timeout:1e4,success:{handler:successHandler},scope:this,dataType:"json"};AJAX_UTIL.send(url,opts)}};$(function(){new searchBoxObj;$.fn.preload=function(){this.each(function(){})},"undefined"!=typeof mainAdCarouselImages&&$([mainAdCarouselImages[0],mainAdCarouselImages[1],mainAdCarouselImages[2]]).preload(),$(".js-example-basic-single").select2()});